name: gstreamer # you probably want to 'snapcraft register <name>'
version: '0.1' # just for humans, typically '1.2+git' or '1.3.2'
summary: gstreamer packaged as snap # 79 char long summary
description: |
  GStreamer is a library for constructing graphs of media-handling components. The applications it supports range from simple Ogg/Vorbis playback, audio/video streaming to complex audio (mixing) and video (non-linear editing) processing.(https://gstreamer.freedesktop.org/)


confinement: strict # use 'strict' once you have the right plugs and slots
grade: stable # must be 'stable' to release into candidate/stable channels

parts:
 gstreamer:
    plugin: autotools
    source: https://gstreamer.freedesktop.org/src/gstreamer/gstreamer-1.12.5.tar.xz
    source-checksum: sha256/9f750d845a326880b24c1ccc913d07df8f38cd9e63009714795ae175b6c29c6a
    configflags:
      - --prefix=/usr
      - --disable-benchmarks
      - --disable-debug
      - --disable-examples
      - --disable-gst-debug
      - --disable-gst-tracer-hooks
      - --disable-rpath
      - --disable-tests
      - --disable-tools
    build-packages:
      - bison
      - flex
      - gettext
      - liborc-0.4-dev
      - libpulse-dev
      - libxv-dev
    stage-packages:
      - libpulse0
      - libxv1
    install: |
      find $SNAPCRAFT_PART_INSTALL/usr/lib/pkgconfig -name "*gstreamer*.pc" -exec \
        sed -i "s|/usr/include|$SNAPCRAFT_STAGE/usr/include|g;s|/usr/lib|$SNAPCRAFT_STAGE/usr/lib|g" '{}' \;
    prime:
      - lib/libjson-c*
      - usr/lib/**/libXv.so*
      - usr/lib/gstreamer-1.0
      - -usr/lib/gstreamer-1.0/include
      - usr/lib/libgst*
      - usr/libexec/gstreamer-1.0/gst-plugin-scanner
      - usr/share/locale/*
    build-attributes: [no-system-libraries]


 gst-plugins-base:
    after:
      - gstreamer
    plugin: autotools
    source: https://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-1.12.5.tar.xz
    source-checksum: sha256/8fd9f25b65f3286f43530868b501a4e7cdc3f1568be78c75da716cd2559b712e
    configflags:
      - --prefix=/usr
    build-packages:
      - gettext
      - libfribidi-dev
      - libpulse-dev
    stage-packages:
      - libfribidi0
      - libpulse0
    install: |
      find $SNAPCRAFT_PART_INSTALL/usr/lib/pkgconfig -name "*gstreamer*.pc" -exec \
        sed -i "s|/usr/include|$SNAPCRAFT_STAGE/usr/include|g;s|/usr/lib|$SNAPCRAFT_STAGE/usr/lib|g" '{}' \;
    prime:
      - lib/libjson-c*
      - usr/lib/**/libfribidi.so*
      - usr/lib/gstreamer-1.0
      - -usr/lib/gstreamer-1.0/include
      - usr/lib/libgst*
      - usr/share/locale/*
    build-attributes: [no-system-libraries]