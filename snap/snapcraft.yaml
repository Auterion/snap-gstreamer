name: gstreamer # you probably want to 'snapcraft register <name>'
version: '0.2' # just for humans, typically '1.2+git' or '1.3.2'
summary: gstreamer packaged as snap # 79 char long summary
description: |
  GStreamer is a library for constructing graphs of media-handling components. The applications it supports range from simple Ogg/Vorbis playback, audio/video streaming to complex audio (mixing) and video (non-linear editing) processing.(https://gstreamer.freedesktop.org/)


confinement: strict # use 'strict' once you have the right plugs and slots
grade: stable # must be 'stable' to release into candidate/stable channels

parts:
 gstreamer:
    plugin: autotools
    source: https://gstreamer.freedesktop.org/src/gstreamer/gstreamer-1.5.2.tar.xz
    source-checksum: sha256/96c884e30c4aa7d8ecb6136d467544bec9af36c49dc5f351c3d2ddd23d456c97
    configflags:
      - --prefix=/usr
    build-packages:
      - bison
      - flex
      - gettext
      - liborc-0.4-dev
      - libxv-dev
      - libx32z1-dev

    stage-packages:
      - liborc-0.4-dev
      - libasound2-dev
      - libjpeg-dev
      - libvpx-dev
      - libvorbis-dev
      - libogg-dev
      - libpulse-dev
      - libpulse0
      - libwavpack-dev
      - libvisual-0.4-dev
      - libtag1-dev
      - libopus-dev
      - libcairo-gobject2
      - libgdk-pixbuf2.0-dev
      - libpangocairo-1.0-0
      - libtheora-dev
      - libxv-dev
      - libxdamage-dev
      - libcdparanoia-dev

    prime:
      - usr
    build-attributes: [no-system-libraries]

 gst-plugins-base:
    after:
      - gstreamer
    plugin: autotools
    source: https://gstreamer.freedesktop.org/src/gst-plugins-base/gst-plugins-base-1.5.2.tar.xz
    source-checksum: sha256/a7d65acfb6760eb7f23e1b635a13f643406541f9350a01a8bd84246219db0071
    configflags:
      - --prefix=/usr
    build-packages:
      - bison
      - flex
      - gettext
      - liborc-0.4-dev
    prime:
      - usr
    build-attributes: [no-system-libraries]

 gst-plugins-good:
    after:
      - gstreamer
      - gst-plugins-base
    plugin: autotools
    source: http://gstreamer.freedesktop.org/src/gst-plugins-good/gst-plugins-good-1.5.2.tar.xz
    source-checksum: sha256/f0789d0e4e4e60046327fcf8908c429b6c6c0576a88823497ddc1ea8bfddc993
    configflags:
     - --prefix=/usr
    build-packages:
      - bison
      - flex
      - gettext
      - liborc-0.4-dev
    prime:
      - usr
    build-attributes: [no-system-libraries]

apps:
  gst-launch:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: usr/bin/gst-launch-1.0

  gst-inspect:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: usr/bin/gst-inspect-1.0

  gst-typefind:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: usr/bin/gst-typefind-1.0

  gst-discoverer:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: usr/bin/gst-discoverer-1.0

  gst-play:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: usr/bin/gst-play-1.0

  echopath:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: echo $GST_PLUGIN_PATH

  # uvch264src:
  #   environment:
  #     GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
  #     GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
  #     GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
  #   command: usr/bin/gst-launch-1.0 uvch264src 

  v4l2src:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: usr/bin/gst-launch-1.0 v4l2src 

  videotestsrc:
    environment:
      GST_PLUGIN_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SYSTEM_PATH: $SNAP/usr/lib/gstreamer-1.0
      GST_PLUGIN_SCANNER: $SNAP/usr/libexec/gstreamer-1.0/gst-plugin-scanner
    command: usr/bin/gst-launch-1.0 videotestsrc